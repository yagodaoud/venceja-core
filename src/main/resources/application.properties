# Application
quarkus.application.name=venceja-core
quarkus.http.port=${PORT:8080}

# CORS
quarkus.http.cors=true
quarkus.http.cors.origins=/.*/
quarkus.http.cors.methods=GET,POST,PUT,DELETE,OPTIONS
quarkus.http.cors.headers=*
quarkus.http.cors.exposed-headers=*
quarkus.http.cors.access-control-allow-credentials=true
quarkus.http.cors.access-control-max-age=3600

# Security permissions
quarkus.http.auth.permission.options.paths=/*
quarkus.http.auth.permission.options.methods=OPTIONS
quarkus.http.auth.permission.options.policy=permit

quarkus.http.auth.permission.public.paths=/api/v1/auth/login,/api/v1/auth/refresh,/api/v1/auth/logout,/h2-console/*,/actuator/health
quarkus.http.auth.permission.public.policy=permit

quarkus.http.auth.permission.authenticated.paths=/*
quarkus.http.auth.permission.authenticated.policy=authenticated

# Datasource
quarkus.datasource.db-kind=postgresql
quarkus.datasource.jdbc.url=${DATABASE_URL}
quarkus.datasource.jdbc.driver=org.postgresql.Driver
quarkus.datasource.jdbc.max-size=${DB_POOL_SIZE:10}
quarkus.datasource.jdbc.min-size=${DB_MIN_IDLE:2}
quarkus.datasource.jdbc.idle-removal-interval=5M
quarkus.datasource.jdbc.max-lifetime=30M
quarkus.datasource.jdbc.acquisition-timeout=5S
quarkus.datasource.username=${DB_USERNAME}
quarkus.datasource.password=${DB_PASSWORD}

# Hibernate
quarkus.hibernate-orm.database.generation=validate
quarkus.hibernate-orm.dialect=org.hibernate.dialect.PostgreSQLDialect
quarkus.hibernate-orm.log.sql=${SHOW_SQL:false}
quarkus.hibernate-orm.jdbc.timezone=America/Sao_Paulo

# Flyway
quarkus.flyway.migrate-at-start=true
quarkus.flyway.locations=db/migration
quarkus.flyway.baseline-on-migrate=true

# ==============================================================================
# JWT Configuration (Environment Aware)
# ==============================================================================

# --------------------------------------
# 1. LOCAL DEVELOPMENT (Uses Files)
# --------------------------------------
%dev.smallrye.jwt.sign.key.location=privateKey.pem
%dev.mp.jwt.verify.publickey.location=publicKey.pem

# --------------------------------------
# 2. PRODUCTION / RAILWAY (Uses Env Vars)
# --------------------------------------

# Reading the Private Key (Signing)
%prod.smallrye.jwt.sign.key=${JWT_PRIVATE_KEY}

# Reading the Public Key (Verification)
%prod.mp.jwt.verify.publickey=${JWT_PUBLIC_KEY}

# --------------------------------------
# 3. GLOBAL SETTINGS
# --------------------------------------
smallrye.jwt.verify.algorithm=RS256
mp.jwt.verify.issuer=https://venceja.com

# Custom JWT properties
jwt.expiration=${JWT_EXPIRATION:86400000}
jwt.issuer=https://venceja.com
jwt.refresh-token.expiration=${JWT_REFRESH_EXPIRATION:2592000000}
jwt.refresh-token.max-per-user=${JWT_MAX_TOKENS_PER_USER:5}

# Google credentials
google.credentials.json=${GOOGLE_APPLICATION_CREDENTIALS_JSON:}
google.credentials.path=${GOOGLE_APPLICATION_CREDENTIALS:}
google.credentials.resource=${GOOGLE_CREDENTIALS_RESOURCE:venceja-google.json}

# Firebase credentials
firebase.credentials.json=${FIREBASE_APPLICATION_CREDENTIALS_JSON:}
firebase.credentials.path=${FIREBASE_APPLICATION_CREDENTIALS:}
firebase.credentials.resource=${FIREBASE_CREDENTIALS_RESOURCE:venceja-firebase.json}
firebase.storage.bucket=${FIREBASE_BUCKET:}
firebase.storage.project-id=${FIREBASE_PROJECT_ID:}

# Rate limit
rate-limit.requests-per-minute=${RATE_LIMIT:100}

# ===================================
# DEV PROFILE
# ===================================
%dev.quarkus.datasource.db-kind=h2
%dev.quarkus.datasource.jdbc.url=jdbc:h2:file:./db/venceja;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE
%dev.quarkus.datasource.jdbc.driver=org.h2.Driver
%dev.quarkus.hibernate-orm.dialect=org.hibernate.dialect.H2Dialect
%dev.quarkus.hibernate-orm.log.sql=true

# ===================================
# PROD PROFILE
# ===================================
%prod.quarkus.datasource.jdbc.max-size=3
%prod.quarkus.datasource.jdbc.min-size=1
%prod.quarkus.datasource.jdbc.idle-removal-interval=5M
%prod.quarkus.datasource.jdbc.max-lifetime=15M
%prod.quarkus.hibernate-orm.statistics=false
%prod.quarkus.log.level=WARN
%prod.quarkus.log.category."com.yagodaoud.venceja".level=INFO

# ===================================
# LOCAL-POSTGRES PROFILE
# ===================================
%local-postgres.quarkus.datasource.jdbc.url=jdbc:postgresql://localhost:5432/venceja
%local-postgres.quarkus.datasource.username=postgres
%local-postgres.quarkus.datasource.password=postgres


quarkus.package.type=uber-jar
quarkus.package.output-name=app