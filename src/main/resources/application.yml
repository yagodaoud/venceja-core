quarkus:
  application:
    name: venceja-core
  http:
    port: ${PORT:8080}
    compression:
      level: 6 # Default
    cors:
      origins: "http://localhost:19006,http://localhost:8082,${spring.applications.web-app-url},http://localhost:3000"
      methods: GET,POST,PUT,DELETE,OPTIONS
      headers: "*"
      allow-credentials: true
      max-age: 3600
    auth:
      permission:
        public:
          paths: "/api/v1/auth/login,/api/v1/auth/refresh,/api/v1/auth/logout,/h2-console/*,/actuator/health"
          policy: permit
        authenticated:
          paths: "/*"
          policy: authenticated
  
  datasource:
    db-kind: postgresql
    jdbc:
      url: ${DATABASE_URL}
      driver: org.postgresql.Driver
      # Connection pool settings (Agroal)
      max-size: ${DB_POOL_SIZE:10}
      min-size: ${DB_MIN_IDLE:2}
      idle-removal-interval: 5M
      max-lifetime: 30M
      acquisition-timeout: 5S
    username: ${DB_USERNAME}
    password: ${DB_PASSWORD}

  hibernate-orm:
    database:
      generation: validate
    dialect: org.hibernate.dialect.PostgreSQLDialect
    log:
      sql: ${SHOW_SQL:false}
    jdbc:
      timezone: America/Sao_Paulo

  flyway:
    migrate-at-start: true
    locations: db/migration
    baseline-on-migrate: true

  # SmallRye JWT (if we switch to it, otherwise these are just custom props)
  # For now keeping custom properties for manual JWT handling if needed
  
mp:
  jwt:
    verify:
      issuer: https://venceja.com
      publickey:
        location: ${JWT_SECRET} # Using secret for HS256 verification

smallrye:
  jwt:
    sign:
      key: ${JWT_SECRET}
    verify:
      key: ${JWT_SECRET}
      algorithm: HS256

# Custom properties (mapped from Spring)
jwt:
  secret: ${JWT_SECRET}
  expiration: ${JWT_EXPIRATION:86400000}
  refresh-token:
    expiration: ${JWT_REFRESH_EXPIRATION:2592000000}
    max-per-user: ${JWT_MAX_TOKENS_PER_USER:5}

google:
  credentials:
    json: ${GOOGLE_APPLICATION_CREDENTIALS_JSON:}
    path: ${GOOGLE_APPLICATION_CREDENTIALS:}
    resource: ${GOOGLE_CREDENTIALS_RESOURCE:venceja-google.json}

firebase:
  credentials:
    json: ${FIREBASE_APPLICATION_CREDENTIALS_JSON:}
    path: ${FIREBASE_APPLICATION_CREDENTIALS:}
    resource: ${FIREBASE_CREDENTIALS_RESOURCE:venceja-firebase.json}
  storage:
    bucket: ${FIREBASE_BUCKET:}
    project-id: ${FIREBASE_PROJECT_ID:}

rate-limit:
  requests-per-minute: ${RATE_LIMIT:100}

# Profiles
"%dev":
  quarkus:
    datasource:
      db-kind: h2
      jdbc:
        url: jdbc:h2:file:./db/venceja;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE
        driver: org.h2.Driver
    hibernate-orm:
      dialect: org.hibernate.dialect.H2Dialect
      log:
        sql: true

"%prod":
  quarkus:
    datasource:
      jdbc:
        max-size: 3
        min-size: 1
        idle-removal-interval: 5M
        max-lifetime: 15M
    hibernate-orm:
      statistics: false
      second-level-cache-enabled: false
    log:
      level: WARN
      category:
        "com.yagodaoud.venceja":
          level: INFO

"%local-postgres":
  quarkus:
    datasource:
      jdbc:
        url: jdbc:postgresql://localhost:5432/venceja
        username: postgres
        password: postgres